{% extends "base_centered.html" %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-md-6 my-auto p-3">
    <div class="mb-5">
      <a href="/" class="text-decoration-none"><span class="h3 text-primary">The Evidence Locker</span></a>
    </div>
    <div id="signup-form">
      <h1 class="h2">Set up Two-Factor Authentication</h1>
      <p>To help ensure the safety of users, two-factor authentication is required.</p>
      <form action="/set_otp" method="post">

        <input type="hidden" name="csrf_token" value="{{ user.csrf_token }}">
        <input type="hidden" name="otp_secret" value="{{ otp_secret }}">

        <p>
          <span class="font-weight-bold">Step 1:</span> Scan this barcode (or enter the code) using a two-factor authentication app such as Google Authenticator or Authy.
        </p>
        <div class="text-center mb-3">
          <img class="img-fluid" style="width: 175px;" src="/otp_secret_qr/{{ mfa_secret }}.png">
          <div class="text-small text-muted">Or, enter this code into your authenticator app: {{ mfa_secret }}</div>
        </div>

        <p>
          <span class="font-weight-bold">Step 2:</span> Write down your Two-Factor Recovery Code and store it in a safe place. This code will <span class="font-weight-bold">never</span> be shown again. <span class="font-weight-bold">If you lose your two-factor device, you will not be able to recover your account without this code.</span>
        </p>
        <p class="font-weight-bold text-primary text-center text-monospace">{{ recovery }}</p>
        <p>
          <span class="font-weight-bold">Step 3:</span> Enter your account password and the six digit code generated in your authenticator app
        </p>

        <label for="2fa_input_password">Password</label>
        <input type="password" autocomplete="new-password" class="form-control mb-2" id="2fa_input_password" name="password" oninput="document.getElementById('enable2faButton').disabled=false" autocomplete="off" required>

        <label for="2fa_input">6-digit code</label>
        <input type="text" class="form-control mb-2" id="2fa_input" name="2fa_token" placeholder="# # # # # #" required>

        <button class="btn btn-primary login w-100 mt-3" id="register_button">Continue</button>

      </form>
    </div>
  </div>
</div>
{% endblock %}